<!DOCTYPE html>
<html lang="mr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡§ñ‡§∞‡•á‡§¶‡•Ä ‡§™‡§æ‡§µ‡§§‡•Ä - {{ slip.bill_no }}</title>

<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-size: 10pt;
        font-family: NotoSansDevanagari, Arial, sans-serif;
    }

    /* STRICT A4 PAGE FITTING - ALWAYS ONE PAGE */
    @page {
        size: A4 portrait;
        margin: 10mm;
    }

    @media print {
        @page {
            size: A4;
            margin: 10mm;
        }
        body {
            margin: 0;
            padding: 0;
            max-width: 190mm;
            overflow: hidden;
            font-size: 10pt;
        }
        .no-print {
            display: none !important;
        }
        .slip-container {
            page-break-inside: avoid;
            page-break-after: avoid;
        }
    }

    html, body {
        width: 100%;
        height: 100%;
        overflow: hidden;
        font-size: 10pt;
    }

    body {
        font-family: NotoSansDevanagari, Arial, sans-serif;
        line-height: 1.1;
        color: #000;
        background: #fff;
        max-width: 190mm;
        margin: 0 auto;
        font-size: 10pt;
    }

    .slip-container {
        border: 1.5px solid #000;
        padding: 6px;
        max-width: 100%;
        max-height: 277mm;
        overflow: hidden;
        font-size: 10pt;
    }

    .header {
        text-align: center;
        border-bottom: 1.5px solid #000;
        padding-bottom: 4px;
        margin-bottom: 4px;
        font-size: 10pt;
    }

    .header-logo {
        width: 50px;
        height: 50px;
        margin: 0 auto 4px;
        display: block;
    }

    .header h1 {
        font-size: 10pt; /* kept bigger for title */
        margin-bottom: 2px;
        line-height: 1;
    }

    .header p {
        font-size: 10pt;
        margin: 1px 0;
        line-height: 1;
    }

    .slip-title {
        text-align: center;
        font-size: 10pt; 
        font-weight: bold;
        margin: 3px 0;
        text-decoration: underline;
        line-height: 1;
    }

    .info-row {
        display: flex;
        justify-content: space-between;
        margin: 2px 0;
        font-size: 10pt;
        line-height: 1.5;
    }

    .info-row span {
        flex: 1;
        font-size: 10pt;
    }

    .section {
        margin: 4px 0;
        font-size: 10pt;
    }

    .section-title {
        background: #000;
        color: #fff;
        padding: 2px 6px;
        font-weight: bold;
        font-size: 9pt;
        margin: 4px 0 3px 0;
        line-height: 1.2;
    }

    table {
        width: 100%;
        border-collapse: collapse;
        margin: 3px 0;
        font-size: 10pt;
    }

    table, th, td {
        border: 0.5px solid #000;
    }

    th, td {
        padding: 2px 4px;
        text-align: left;
        line-height: 1.1;
        font-size: 10pt;
    }

    th {
        background: #e8e8e8;
        font-weight: bold;
        font-size: 10pt;
    }

    .text-right {
        text-align: right;
    }

    .text-center {
        text-align: center;
    }

    .total-row {
        font-weight: bold;
        background: #f5f5f5;
        font-size: 10pt;
    }

    .final-amounts {
        margin: 4px 0;
        border: 1.5px solid #000;
        padding: 4px;
        background: #f9f9f9;
        font-size: 10pt;
    }

    .final-amounts div {
        display: flex;
        justify-content: space-between;
        padding: 2px 0;
        font-size: 10pt;
        line-height: 1.1;
    }

    .final-amounts .total-payable {
        font-size: 10pt;
        font-weight: bold;
        border-top: 1.5px solid #000;
        padding-top: 3px;
        margin-top: 2px;
    }

    .balance-amount {
        color: #2e7d32;
        font-size: 10pt;
        font-weight: bold;
    }

    .installments-table {
        font-size: 9pt;
    }

    .installments-table th,
    .installments-table td {
        padding: 1px 3px;
        font-size: 9pt;
    }

    .footer {
        margin-top: 6px;
        display: flex;
        justify-content: space-between;
        font-size: 10pt;
    }

    .signature {
        text-align: center;
        margin-top: 8px;
        font-size: 10pt;
    }

    .signature-line {
        border-top: 1px solid #000;
        width: 150px;
        margin: 0 auto;
        padding-top: 3px;
        font-size: 10pt;
    }

    .field-group {
        margin: 3px 0;
        padding: 3px;
        border: 1px solid #ddd;
        background: #fafafa;
        font-size: 10pt;
    }

    .field-group-title {
        font-weight: bold;
        font-size: 10pt;
        margin-bottom: 2px;
        color: #333;
    }

    @media print {
        html, body {
            height: 297mm;
            overflow: hidden;
            font-size: 10pt;
        }
        .header h1 {
            font-size: 10pt;
        }
        .slip-title {
            font-size: 10pt;
        }
    }

    html, body { height: auto !important; }
.slip-container { max-height: none !important; }

</style>
</head>

<body>
<div class="slip-container">

    <div class="header">
        <div class="slip-title">{{ slip.document_type or '‡§ñ‡§∞‡•á‡§¶‡•Ä ‡§™‡§æ‡§µ‡§§‡•Ä' }}</div>
    </div>

    <div>
        <span><strong>‡§ï‡§Ç‡§™‡§®‡•Ä / ‡§Æ‡§ø‡§≤ ‡§®‡§æ‡§µ:</strong> {{ slip.company_name }}</span><br>
        <span><strong>‡§™‡§§‡•ç‡§§‡§æ:</strong> {{ slip.company_address }}</span><br>
        {% if slip.company_gst_no %}<span><strong>GST ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</strong> {{ slip.company_gst_no }}</span><br>{% endif %}
        {% if slip.company_mobile_no %}<span><strong>‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤ ‡§®‡§Ç‡§¨‡§∞:</strong> {{ slip.company_mobile_no }}</span>{% endif %}
    </div>

    <br>

    <div class="info-row">
        <span><strong>‡§¨‡§ø‡§≤ ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï / ‡§á‡§®‡•ç‡§µ‡•ç‡§π‡•â‡§à‡§∏ ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</strong> #{{ slip.bill_no }}</span>
        <span><strong>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï:</strong> {{ slip.date_formatted or slip.date }}</span>
        <span><strong>‡§µ‡§æ‡§π‡§® ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï:</strong> {{ slip.vehicle_no }}</span>
    </div>

    <!-- ---------------- PARTY DETAILS ---------------- -->
    <div class="section-title">‡§™‡§æ‡§∞‡•ç‡§ü‡•Ä ‡§°‡§ø‡§ü‡•á‡§≤‡•ç‡§∏</div>

    <table>
        <tr>
            <th>‡§™‡§æ‡§∞‡•ç‡§ü‡•Ä ‡§®‡§æ‡§µ</th>
            <td>{{ slip.party_name }}</td>
            <th>‡§§‡§ø‡§ï‡•Ä‡§ü ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</th>
            <td>{{ slip.ticket_no }}</td>
        </tr>

        <tr>
            <th>‡§Æ‡§ü‡•á‡§∞‡§ø‡§Ø‡§≤</th>
            <td>{{ slip.material_name }}</td>
            <th>‡§¶‡§≤‡§æ‡§≤</th>
            <td>{{ slip.broker }}</td>
        </tr>

        <tr>
            <th>‡§°‡§ø‡§≤‡§ø‡§µ‡•ç‡§π‡§∞‡•Ä ‡§Ö‡§ü‡•Ä</th>
            <td>{{ slip.terms_of_delivery }}</td>
            <th>‡§∏‡§™‡•ç‡§≤‡§æ‡§Ø‡§∞ ‡§á‡§®‡§µ‡•ç‡§π‡•â‡§à‡§∏ ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</th>
            <td>{{ slip.sup_inv_no }}</td>
        </tr>

        <tr>
            <th>GST ‡§ï‡•ç‡§∞‡§Æ‡§æ‡§Ç‡§ï</th>
            <td colspan="3">{{ slip.gst_no }}</td>
        </tr>

        <tr>
            <th>‡§Æ‡•ã‡§¨‡§æ‡§à‡§≤ ‡§®‡§Ç‡§¨‡§∞</th>
            <td colspan="3">{{ slip.mobile_number }}</td>
        </tr>
    </table>

    <!-- ---------------- WEIGHT DETAILS ---------------- -->
    <div class="section-title">‡§µ‡§ú‡§® ‡§µ ‡§¶‡§∞ ‡§§‡§™‡§∂‡•Ä‡§≤</div>

    <table>
        <tr>
            <th>‡§¨‡•Ö‡§ó‡•ç‡§∏</th>
            <th>‡§∏‡§∞‡§æ‡§∏‡§∞‡•Ä ‡§¨‡•Ö‡§ó‡•ç‡§∏ ‡§µ‡§ú‡§®</th>
            <th>‡§®‡§ø‡§µ‡•ç‡§µ‡§≥ ‡§µ‡§ú‡§® (KG)</th>
            <th>‡§¨‡•ã‡§∞‡§æ ‡§µ‡§ú‡§® (KG)</th>
            <th>‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§µ‡§ú‡§® (KG)</th>
            <th>‡§µ‡§ú‡§® (‡§ï‡•ç‡§µ‡§ø‡§Ç‡§ü‡§≤)</th>
            <th>‡§µ‡§ú‡§® (‡§ñ‡§Ç‡§°‡•Ä)</th>
            <th>‡§∞‡•á‡§ü ‡§¨‡•á‡§∏‡§ø‡§∏</th>
            <th>‡§∞‡•á‡§ü</th>
            <th>‡§∞‡§ï‡•ç‡§ï‡§Æ (‚Çπ)</th>
        </tr>

        <tr>
            <td class="text-center">{{ "%.0f"|format(slip.bags) }}</td>
            <td class="text-right">{{ "%.2f"|format(slip.avg_bag_weight) }}</td>
            <td class="text-right">{{ "%.2f"|format(slip.net_weight_kg) }}</td>
            <td class="text-right">{{ "%.2f"|format(slip.gunny_weight_kg) }}</td>
            <td class="text-right">{{ "%.2f"|format(slip.final_weight_kg) }}</td>
            <td class="text-right">{{ "%.3f"|format(slip.weight_quintal) }}</td>
            <td class="text-right">{{ "%.3f"|format(slip.weight_khandi) }}</td>
            <td class="text-center">{{ slip.rate_basis }}</td>
            <td class="text-right">{{ "%.2f"|format(slip.rate_value) }}</td>
            <td class="text-right">{{ "%.2f"|format(slip.total_purchase_amount) }}</td>
        </tr>
    </table>

    <!-- ---------------- DEDUCTIONS ---------------- -->
    <div class="section-title">‡§ï‡§™‡§æ‡§§</div>

    <table>
        <thead>
            <tr>
                <th>‡§ï‡§™‡§æ‡§§‡•Ä‡§ö‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞</th>
                <th>‡§¶‡§∞ / ‡§ü‡§ï‡•ç‡§ï‡•á‡§µ‡§æ‡§∞‡•Ä</th>
                <th class="text-right">‡§∞‡§ï‡•ç‡§ï‡§Æ (‚Çπ)</th>
            </tr>
        </thead>

        <tbody>

            {% if slip.bank_commission > 0 %}
            <tr>
                <td>‡§¨‡§Å‡§ï ‡§ï‡§Æ‡§ø‡§∂‡§®</td>
                <td>-</td>
                <td class="text-right">{{ "%.2f"|format(slip.bank_commission) }}</td>
            </tr>
            {% endif %}

            {% if slip.postage > 0 %}
            <tr>
                <td>‡§ü‡§™‡§æ‡§≤ ‡§ñ‡§∞‡•ç‡§ö</td>
                <td>-</td>
                <td class="text-right">{{ "%.2f"|format(slip.postage) }}</td>
            </tr>
            {% endif %}

            {% if slip.freight > 0 %}
            <tr>
                <td>‡§µ‡§æ‡§π‡§§‡•Ç‡§ï</td>
                <td>-</td>
                <td class="text-right">{{ "%.2f"|format(slip.freight) }}</td>
            </tr>
            {% endif %}

            {% if slip.rate_diff > 0 %}
            <tr>
                <td>‡§¶‡§∞ ‡§´‡§∞‡§ï</td>
                <td>-</td>
                <td class="text-right">{{ "%.2f"|format(slip.rate_diff) }}</td>
            </tr>
            {% endif %}

            {% if slip.quality_diff > 0 %}
            <tr>
                <td>‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ ‡§´‡§∞‡§ï {% if slip.quality_diff_comment %}<br><small>({{ slip.quality_diff_comment }})</small>{% endif %}</td>
                <td>-</td>
                <td class="text-right">{{ "%.2f"|format(slip.quality_diff) }}</td>
            </tr>
            {% endif %}

            {% if slip.moisture_ded > 0 %}
            <tr>
                <td>‡§ì‡§≤‡§æ‡§µ‡§æ ‡§ï‡§™‡§æ‡§§{% if slip.moisture_ded_comment %}<br><small>({{ slip.moisture_ded_comment }})</small>{% endif %}</td>
                <td>
                    {% if slip.moisture_ded_percent > 0 %}
                        {{ "%.2f"|format(slip.moisture_ded_percent) }}%
                    {% else %}
                        -
                    {% endif %}
                </td>
                <td class="text-right">{{ "%.2f"|format(slip.moisture_ded) }}</td>
            </tr>
            {% endif %}

            {% if slip.tds > 0 %}
            <tr>
                <td>TDS</td>
                <td>-</td>
                <td class="text-right">{{ "%.2f"|format(slip.tds) }}</td>
            </tr>
            {% endif %}

            {% if slip.batav > 0 %}
            <tr>
                <td>‡§¨‡§ü‡§æ‡§µ‡§Ç</td>
                <td>{{ "%.2f"|format(slip.batav_percent) }}%</td>
                <td class="text-right">{{ "%.2f"|format(slip.batav) }}</td>
            </tr>
            {% endif %}

            {% if slip.dalali > 0 %}
            <tr>
                <td>‡§¶‡§≤‡§æ‡§≤‡•Ä</td>
                <td>‚Çπ{{ "%.2f"|format(slip.dalali_rate) }}/100 KG</td>
                <td class="text-right">{{ "%.2f"|format(slip.dalali) }}</td>
            </tr>
            {% endif %}

            {% if slip.hammali > 0 %}
            <tr>
                <td>‡§π‡§Æ‡§æ‡§≤‡•Ä</td>
                <td>‚Çπ{{ "%.2f"|format(slip.hammali_rate) }}/100 KG</td>
                <td class="text-right">{{ "%.2f"|format(slip.hammali) }}</td>
            </tr>
            {% endif %}

            <tr class="total-row">
                <td colspan="2">‡§è‡§ï‡•Ç‡§£ ‡§ï‡§™‡§æ‡§§</td>
                <td class="text-right">{{ "%.2f"|format(slip.total_deduction) }}</td>
            </tr>

        </tbody>
    </table>

    <!-- ---------------- AMOUNT SUMMARY ---------------- -->
    <div class="final-amounts">
        <div>
            <span>‡§è‡§ï‡•Ç‡§£ ‡§∞‡§ï‡•ç‡§ï‡§Æ:</span>
            <span>‚Çπ {{ "%.2f"|format(slip.total_purchase_amount) }}</span>
        </div>

        <div>
            <span>‡§è‡§ï‡•Ç‡§£ ‡§ï‡§™‡§æ‡§§:</span>
            <span>‚Çπ {{ "%.2f"|format(slip.total_deduction) }}</span>
        </div>

        <div class="total-payable">
            <span>‡§®‡§ø‡§µ‡•ç‡§µ‡§≥ ‡§¶‡•á‡§Ø ‡§∞‡§ï‡•ç‡§ï‡§Æ:</span>
            <span>‚Çπ {{ "%.2f"|format(slip.payable_amount) }}</span>
        </div>
    </div>

    <!-- ---------------- PAYMENT SUMMARY ---------------- -->
    <div class="section-title" style="background:#2e7d32;">üí∞ ‡§¶‡•á‡§Ø‡§ï ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂</div>

    <table style="border:2px solid #2e7d32; background:#e8f5e9;">
        <tr>
            <td><strong>‡§¶‡•á‡§Ø ‡§∞‡§ï‡•ç‡§ï‡§Æ:</strong></td>
            <td class="text-right"><strong>‚Çπ {{ "%.2f"|format(slip.payable_amount) }}</strong></td>
        </tr>
        <tr>
            <td><strong>‡§è‡§ï‡•Ç‡§£ ‡§¶‡§ø‡§≤‡•á‡§≤‡•Ä ‡§∞‡§ï‡•ç‡§ï‡§Æ:</strong></td>
            <td class="text-right"><strong>‚Çπ {{ "%.2f"|format(slip.total_paid_amount) }}</strong></td>
        </tr>
        <tr style="background:#c8e6c9;">
            <td><strong>‡§∂‡§ø‡§≤‡•ç‡§≤‡§ï ‡§∞‡§ï‡•ç‡§ï‡§Æ:</strong></td>
            <td class="text-right" style="color:#1b5e20;"><strong>‚Çπ {{ "%.2f"|format(slip.balance_amount) }}</strong></td>
        </tr>
    </table>

    <!-- ---------------- INSTALLMENTS ---------------- -->
    {% set has_instalments = slip.instalment_1_date or slip.instalment_1_amount or slip.instalment_1_comment or slip.instalment_2_date or slip.instalment_2_amount or slip.instalment_2_comment or slip.instalment_3_date or slip.instalment_3_amount or slip.instalment_3_comment or slip.instalment_4_date or slip.instalment_4_amount or slip.instalment_4_comment or slip.instalment_5_date or slip.instalment_5_amount or slip.instalment_5_comment %}
        {% if has_instalments %}
    <div class="section-title">‡§π‡§™‡•ç‡§§‡•á ‡§§‡§™‡§∂‡•Ä‡§≤</div>

    <table class="installments-table">
        <thead>
            <tr>
                <th>‡§ï‡•ç‡§∞.</th>
                <th>‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï</th>
                <th>‡§∞‡§ï‡•ç‡§ï‡§Æ</th>
                <th>‡§™‡§¶‡•ç‡§ß‡§§</th>
                <th>‡§¨‡§Å‡§ï ‡§ñ‡§æ‡§§‡•á</th>
                <th>‡§ü‡§ø‡§™‡•ç‡§™‡§£‡•Ä</th>
            </tr>
        </thead>

        <tbody>
            {% for i in range(1, 6) %}
            {% set date_field = 'instalment_' ~ i ~ '_date' %}
            {% set amount_field = 'instalment_' ~ i ~ '_amount' %}
            {% set method_field = 'instalment_' ~ i ~ '_payment_method' %}
            {% set bank_field = 'instalment_' ~ i ~ '_payment_bank_account' %}
            {% set comment_field = 'instalment_' ~ i ~ '_comment' %}

            {% set date = slip[date_field] %}
            {% set amount = slip[amount_field] %}
            {% set method = slip[method_field] %}
            {% set bank = slip[bank_field] %}
            {% set comment = slip[comment_field] %}

            {% if date or amount or method or bank or comment %}
            <tr>
                <td class="text-center">{{ i }}</td>
                <td>{{ date }}</td>
                <td class="text-right">‚Çπ{{ "%.2f"|format(amount) }}</td>
                <td>{{ method }}</td>
                <td>{{ bank }}</td>
                <td>{{ comment }}</td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>
    {% endif %}

    <!-- ---------------- GODOWN ---------------- -->
    {% if slip.paddy_unloading_godown %}
    <div class="field-group">
        <div class="field-group-title">‡§ß‡§æ‡§® ‡§â‡§§‡§æ‡§∞ ‡§ó‡•ã‡§¶‡§æ‡§Æ</div>
        <div>{{ slip.paddy_unloading_godown }}</div>
    </div>
    {% endif %}

    <!-- ---------------- SIGNATURES ---------------- -->
    <div class="footer">
        <div class="signature-line">‡§§‡§Ø‡§æ‡§∞ ‡§ï‡•á‡§≤‡•á<br>{{ slip.prepared_by }}</div>
        <div class="signature-line">‡§Ö‡§ß‡§ø‡§ï‡•É‡§§ ‡§∏‡•ç‡§µ‡§æ‡§ï‡•ç‡§∑‡§∞‡•Ä<br>{{ slip.authorised_sign }}</div>
    </div>

</div>

</body>
</html>
